# VisDrone+UAVDT è”åˆæ•°æ®é›†é…ç½®ä¿®æ”¹æŒ‡å—

**æ—¥æœŸ**: 2025-11-02  
**ç›®æ ‡**: å°† VisDrone å’Œ UAVDT è”åˆè®­ç»ƒï¼Œä¿®æ­£é…ç½®æ–‡ä»¶å’Œæ•°æ®åŠ è½½

---

## ğŸ“‹ ä½ çš„é…ç½®æ–‡ä»¶é—®é¢˜åˆ†æ

### âŒ é—®é¢˜ 1: è·¯å¾„æ ¼å¼é”™è¯¯

**å½“å‰é…ç½®**:

```yaml
train:
  - VisDrone2019-DET-YOLO/VisDrone2YOLO/VisDrone2019-DET-train/images/rgb
  - UAVDT_YOLO/train/images/rgb

train_depth:
  - VisDrone2019-DET-YOLO/VisDrone2YOLO/VisDrone2019-DET-train/images/d
  - UAVDT_YOLO/train/images/d
```

**é—®é¢˜**:

- âœ… ä½¿ç”¨åˆ—è¡¨æ ¼å¼ (list) æ˜¯**æ­£ç¡®çš„** - `YOLORGBDDataset` æ”¯æŒå¤šè·¯å¾„
- âŒ ä½†è·¯å¾„ç»“å°¾ä¸åº”è¯¥æ˜¯ `/rgb` å’Œ `/d` - åº”è¯¥ç›´æ¥åˆ°å›¾åƒç›®å½•ï¼
- âŒ VisDrone çš„è·¯å¾„å¤ªæ·±äº†ï¼Œåº”è¯¥ç®€åŒ–

### âŒ é—®é¢˜ 2: éªŒè¯é›†æ··ç”¨äº† UAVDT

**å½“å‰é…ç½®**:

```yaml
val:
  - VisDrone2019-DET-YOLO/VisDrone2YOLO/VisDrone2019-DET-val/images/rgb
  - UAVDT_YOLO/val/images/rgb # âŒ ä¸åº”è¯¥ç”¨UAVDTéªŒè¯é›†ï¼
```

**é—®é¢˜**:

- âŒ éªŒè¯é›†åº”è¯¥**åªç”¨ VisDrone** (å¯¹é½ RemDet è®ºæ–‡è¯„ä¼°)
- âŒ UAVDT çš„éªŒè¯é›†å’Œ VisDrone åˆ†å¸ƒå¯èƒ½ä¸åŒï¼Œæ··ç”¨ä¼šå½±å“æŒ‡æ ‡å¯¹æ¯”

### âŒ é—®é¢˜ 3: è·¯å¾„å±‚çº§ä¸å¯¹

**æ ¹æ®`YOLORGBDDataset`çš„é€»è¾‘**:

- RGB è·¯å¾„åº”è¯¥æŒ‡å‘: `images/train/` (åŒ…å«.jpg æ–‡ä»¶çš„ç›®å½•)
- Depth è·¯å¾„åº”è¯¥æŒ‡å‘: `depths/train/` (åŒ…å«.png æ–‡ä»¶çš„ç›®å½•)
- **ä¸åº”è¯¥å†æœ‰ `/rgb` æˆ– `/d` åç¼€ï¼**

---

## âœ… æ­£ç¡®çš„é…ç½®æ ¼å¼

### ä¿®æ”¹åçš„å®Œæ•´é…ç½®

```yaml
# Ultralytics YOLO ğŸš€, AGPL-3.0 license
# VisDrone + UAVDT Joint RGB-D Dataset Configuration
# Multi-dataset training for enhanced UAV object detection

# Dataset root path
path: /data2/user/2024/lzy/Datasets/

# RGB image paths (å¤šæ•°æ®é›†åˆ—è¡¨)
train:
  - VisDrone2019-DET-YOLO/VisDrone2YOLO/VisDrone2019-DET-train/images # VisDroneè®­ç»ƒé›†
  - UAVDT_YOLO/train/images # UAVDTè®­ç»ƒé›†

val:
  - VisDrone2019-DET-YOLO/VisDrone2YOLO/VisDrone2019-DET-val/images # åªç”¨VisDroneéªŒè¯é›†

test:
  - VisDrone2019-DET-YOLO/VisDrone2YOLO/VisDrone2019-DET-val/images # æµ‹è¯•é›†åŒéªŒè¯é›†

# Depth paths (å¤šæ•°æ®é›†åˆ—è¡¨)
train_depth:
  - VisDrone2019-DET-YOLO/VisDrone2YOLO/VisDrone2019-DET-train/depths # VisDroneæ·±åº¦å›¾
  - UAVDT_YOLO/train/depths # UAVDTæ·±åº¦å›¾

val_depth:
  - VisDrone2019-DET-YOLO/VisDrone2YOLO/VisDrone2019-DET-val/depths # åªç”¨VisDroneæ·±åº¦å›¾

test_depth:
  - VisDrone2019-DET-YOLO/VisDrone2YOLO/VisDrone2019-DET-val/depths

# Number of classes
nc: 10

# Class names (VisDrone 10ç±»)
names:
  0: pedestrian
  1: people
  2: bicycle
  3: car
  4: van
  5: truck
  6: tricycle
  7: awning-tricycle
  8: bus
  9: motor
# âš ï¸ é‡è¦è¯´æ˜: UAVDTåªæœ‰3ç±» (car/truck/bus)ï¼Œä¼šè‡ªåŠ¨æ˜ å°„åˆ°VisDroneçš„ç±»åˆ«4/5/8
```

---

## ğŸ”§ éœ€è¦ä¿®æ”¹æ•°æ®åŠ è½½ä»£ç å—ï¼Ÿ

### âœ… å¥½æ¶ˆæ¯: `YOLORGBDDataset` å·²ç»æ”¯æŒå¤šè·¯å¾„ï¼

**å½“å‰ä»£ç å·²ç»æ”¯æŒ**:

1. âœ… åˆ—è¡¨æ ¼å¼çš„ train/val paths
2. âœ… åˆ—è¡¨æ ¼å¼çš„ train_depth/val_depth paths
3. âœ… è‡ªåŠ¨ RGB-Depth é…å¯¹
4. âœ… ç¼ºå¤±æ·±åº¦å›¾çš„å®¹é”™å¤„ç†

**å…³é”®ä»£ç ** (dataset.py ç¬¬ 484-500 è¡Œ):

```python
# Collect RGB and Depth root directories
rgb_roots = self._collect_existing_dirs(self._input_img_paths)
depth_roots = self._resolve_modal_roots(depth_entry)

# Broadcast single depth root to multiple RGB roots if needed
if len(depth_roots) == 1 and len(rgb_roots) > 1:
    depth_roots = depth_roots * len(rgb_roots)

if len(rgb_roots) != len(depth_roots):
    LOGGER.warning(...)
    return

# Build RGBâ†’Depth directory pairs
self._depth_pairs = list(zip(rgb_roots, depth_roots))
```

è¿™æ®µä»£ç å·²ç»å¤„ç†äº†å¤šæ•°æ®é›†çš„æƒ…å†µï¼

---

## âš ï¸ ä½†æœ‰ä¸€ä¸ªæ½œåœ¨é—®é¢˜éœ€è¦ç¡®è®¤

### æ£€æŸ¥ç‚¹: ç›®å½•ç»“æ„æ˜¯å¦æ­£ç¡®ï¼Ÿ

**VisDrone é¢„æœŸç»“æ„**:

```
VisDrone2019-DET-train/
â”œâ”€â”€ images/
â”‚   â”œâ”€â”€ 0000001_00159_d_0000001.jpg
â”‚   â”œâ”€â”€ 0000001_00159_d_0000002.jpg
â”‚   â””â”€â”€ ...
â”œâ”€â”€ depths/
â”‚   â”œâ”€â”€ 0000001_00159_d_0000001.png
â”‚   â”œâ”€â”€ 0000001_00159_d_0000002.png
â”‚   â””â”€â”€ ...
â””â”€â”€ labels/
    â”œâ”€â”€ 0000001_00159_d_0000001.txt
    â””â”€â”€ ...
```

**UAVDT é¢„æœŸç»“æ„** (è¿è¡Œ convert_uavdt_to_yolo.py å):

```
UAVDT_YOLO/
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â”œâ”€â”€ M0101_000001.jpg
â”‚   â”‚   â”œâ”€â”€ M0101_000002.jpg
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ depths/
â”‚   â”‚   â”œâ”€â”€ M0101_000001.png
â”‚   â”‚   â”œâ”€â”€ M0101_000002.png
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ labels/
â”‚       â”œâ”€â”€ M0101_000001.txt
â”‚       â””â”€â”€ ...
â””â”€â”€ val/  (å¦‚æœæœ‰)
```

**å¦‚æœä½ çš„ç›®å½•æ˜¯è¿™æ ·**:

```
VisDrone2019-DET-train/
â”œâ”€â”€ images/
â”‚   â”œâ”€â”€ rgb/  â† âŒ å¤šäº†ä¸€å±‚!
â”‚   â”‚   â”œâ”€â”€ xxx.jpg
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ d/  â† âŒ è¿™é‡Œåº”è¯¥æ˜¯depths/
â”‚       â”œâ”€â”€ xxx.png
â”‚       â””â”€â”€ ...
```

**é‚£å°±éœ€è¦ä¿®æ”¹ç›®å½•ç»“æ„ï¼**

---

## ğŸ› ï¸ ä¿®æ”¹æ–¹æ¡ˆ

### æ–¹æ¡ˆ A: ä¿®æ”¹ YAML é…ç½® (å¦‚æœä½ çš„ç›®å½•ç¡®å®æœ‰ rgb/d å­ç›®å½•)

å¦‚æœä½ çš„ç›®å½•ç»“æ„æ˜¯:

```
images/rgb/xxx.jpg
images/d/xxx.png
```

**ä¿®æ”¹ä¸º** (å‘Šè¯‰ YOLORGBDDataset å®Œæ•´è·¯å¾„):

```yaml
train:
  - VisDrone2019-DET-YOLO/.../images/rgb
  - UAVDT_YOLO/train/images/rgb

train_depth:
  - VisDrone2019-DET-YOLO/.../images/d # æ³¨æ„: ä¸æ˜¯depthsï¼Œæ˜¯d
  - UAVDT_YOLO/train/images/d
```

**ä½†è¿™éœ€è¦ä¿®æ”¹æ•°æ®åŠ è½½ä»£ç ï¼** (ä¸æ¨è)

### æ–¹æ¡ˆ B: é‡ç»„ç›®å½•ç»“æ„ (æ¨è!) â­

**é‡å‘½å/ç§»åŠ¨æ–‡ä»¶**:

#### VisDrone:

```bash
# å¦‚æœæ˜¯ images/rgb/ å’Œ images/d/
cd VisDrone2019-DET-train/images/
mv rgb/* ./  # å°†rgb/ä¸‹çš„æ–‡ä»¶ç§»åˆ°images/
rmdir rgb

# é‡å‘½å d/ ä¸º depths/
mv d ../depths
```

#### UAVDT (generate_depths_uavdt.py ä¼šè‡ªåŠ¨åˆ›å»ºæ­£ç¡®ç»“æ„):

```bash
# ç¡®ä¿è¾“å‡ºåˆ° UAVDT_YOLO/train/depths/
# è€Œä¸æ˜¯ UAVDT_YOLO/train/images/d/
```

---

## ğŸ“ å®Œæ•´ä¿®æ”¹æ¸…å•

### 1. ä¿®æ”¹ visdrone_uavdt_joint.yaml

<details>
<summary>ç‚¹å‡»æŸ¥çœ‹å®Œæ•´ä¿®æ”¹</summary>

```yaml
path: /data2/user/2024/lzy/Datasets/

train:
  - VisDrone2019-DET-YOLO/VisDrone2YOLO/VisDrone2019-DET-train/images
  - UAVDT_YOLO/train/images

val:
  - VisDrone2019-DET-YOLO/VisDrone2YOLO/VisDrone2019-DET-val/images

test:
  - VisDrone2019-DET-YOLO/VisDrone2YOLO/VisDrone2019-DET-val/images

train_depth:
  - VisDrone2019-DET-YOLO/VisDrone2YOLO/VisDrone2019-DET-train/depths
  - UAVDT_YOLO/train/depths

val_depth:
  - VisDrone2019-DET-YOLO/VisDrone2YOLO/VisDrone2019-DET-val/depths

test_depth:
  - VisDrone2019-DET-YOLO/VisDrone2YOLO/VisDrone2019-DET-val/depths

nc: 10

names:
  0: pedestrian
  1: people
  2: bicycle
  3: car
  4: van
  5: truck
  6: tricycle
  7: awning-tricycle
  8: bus
  9: motor
```

</details>

### 2. ç¡®è®¤ç›®å½•ç»“æ„

```bash
# åœ¨æœåŠ¡å™¨è¿è¡Œ
ls -la /data2/user/2024/lzy/Datasets/VisDrone2019-DET-YOLO/.../VisDrone2019-DET-train/

# åº”è¯¥çœ‹åˆ°:
# images/  (ç›´æ¥åŒ…å«.jpgï¼Œä¸åº”è¯¥æœ‰rgb/å­ç›®å½•)
# depths/  (ç›´æ¥åŒ…å«.pngï¼Œä¸åº”è¯¥æ˜¯d/)
# labels/  (ç›´æ¥åŒ…å«.txt)
```

### 3. ä¿®æ”¹ generate_depths_uavdt.py (å¦‚æœéœ€è¦)

ç¡®ä¿è¾“å‡ºè·¯å¾„æ˜¯:

```python
output_dir=uavdt_yolo / 'train' / 'depths'  # âœ… æ­£ç¡®
# ä¸æ˜¯: uavdt_yolo / 'train' / 'images' / 'd'  # âŒ é”™è¯¯
```

### 4. éªŒè¯é…ç½®

åˆ›å»ºéªŒè¯è„šæœ¬:

```python
# verify_joint_dataset.py
from ultralytics.data import YOLORGBDDataset
from pathlib import Path

# åŠ è½½é…ç½®
data_yaml = Path('data/visdrone_uavdt_joint.yaml')
dataset = YOLORGBDDataset(
    img_path='train',
    data=data_yaml,
    augment=False
)

print(f"âœ… æ€»å›¾åƒæ•°: {len(dataset.im_files)}")
print(f"âœ… VisDroneå›¾åƒ: {sum(1 for p in dataset.im_files if 'VisDrone' in p)}")
print(f"âœ… UAVDTå›¾åƒ: {sum(1 for p in dataset.im_files if 'UAVDT' in p)}")

if dataset.depth_files:
    print(f"âœ… æ€»æ·±åº¦å›¾: {len(dataset.depth_files)}")
    print(f"âœ… æ·±åº¦å·²å¯ç”¨")
else:
    print(f"âŒ æ·±åº¦å›¾æœªåŠ è½½!")

# åŠ è½½ç¬¬ä¸€å¼ å›¾åƒæµ‹è¯•
img, _, _ = dataset.load_image(0)
print(f"âœ… å›¾åƒå½¢çŠ¶: {img.shape}")  # åº”è¯¥æ˜¯ (H, W, 4)
if img.shape[2] == 4:
    print(f"âœ… RGB-DåŠ è½½æˆåŠŸ!")
else:
    print(f"âŒ åªæœ‰RGBé€šé“!")
```

---

## ğŸ¯ æ€»ç»“ - éœ€è¦æ”¹åŠ¨çš„åœ°æ–¹

### âœ… å¿…é¡»ä¿®æ”¹

1. **visdrone_uavdt_joint.yaml**:

   - ç§»é™¤è·¯å¾„ä¸­çš„ `/rgb` å’Œ `/d` åç¼€
   - éªŒè¯é›†åªç”¨ VisDroneï¼Œä¸è¦ UAVDT

2. **ç¡®è®¤ç›®å½•ç»“æ„**:
   - ç¡®ä¿ `images/` ç›´æ¥åŒ…å«.jpg (ä¸è¦æœ‰ rgb/å­ç›®å½•)
   - ç¡®ä¿ `depths/` ç›´æ¥åŒ…å«.png (ä¸è¦æ˜¯ d/ç›®å½•)

### â¸ï¸ å¯èƒ½éœ€è¦ä¿®æ”¹ (å–å†³äºä½ çš„å®é™…ç›®å½•)

3. **ç›®å½•é‡ç»„**:
   - å¦‚æœæœ‰ rgb/å’Œ d/å­ç›®å½•ï¼Œéœ€è¦é‡ç»„
   - æˆ–è€…ä¿®æ”¹æ•°æ®åŠ è½½ä»£ç é€‚é… (ä¸æ¨è)

### âŒ ä¸éœ€è¦ä¿®æ”¹

4. **æ•°æ®åŠ è½½ä»£ç ** (`YOLORGBDDataset`):
   - âœ… å·²ç»æ”¯æŒå¤šè·¯å¾„
   - âœ… å·²ç»æ”¯æŒ RGB-Depth é…å¯¹
   - âœ… ä¸éœ€è¦ä¿®æ”¹ï¼

---

**ä¸‹ä¸€æ­¥**: å‘Šè¯‰æˆ‘ä½ çš„å®é™…ç›®å½•ç»“æ„ï¼Œæˆ‘å¸®ä½ ç¡®å®šæœ€ç»ˆçš„ YAML é…ç½®ï¼
