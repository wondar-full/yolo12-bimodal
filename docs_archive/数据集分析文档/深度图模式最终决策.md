# æ·±åº¦å›¾æ¨¡å¼æœ€ç»ˆå†³ç­– - L æ¨¡å¼ vs I æ¨¡å¼

**æ—¥æœŸ**: 2025-11-01  
**å†³ç­–**: **ç»Ÿä¸€ä½¿ç”¨ L æ¨¡å¼ (8-bit, 0-255)** â­â­â­â­â­

---

## ğŸ¯ æ ¸å¿ƒå†³ç­–

### âœ… æ¨èï¼šL æ¨¡å¼ (8-bit ç°åº¦)

**ç†ç”±**:

1. âœ… **ç²¾åº¦è¶³å¤Ÿ**: 256 ä¸ªç°åº¦çº§åˆ«å¯¹äºæ·±åº¦ç‰¹å¾æå–å®Œå…¨å¤Ÿç”¨
2. âœ… **ä½ çš„ VisDrone å·²ç»æ˜¯ L æ¨¡å¼**: Depth Anything V2 è¾“å‡ºçš„æ˜¯ uint8 (0-255)
3. âœ… **å­˜å‚¨å‹å¥½**: UAVDT èŠ‚çœ 150GB ç©ºé—´ (50GB vs 200GB)
4. âœ… **è®­ç»ƒæ•ˆç‡é«˜**: è¯»å–é€Ÿåº¦å¿« 4 å€
5. âœ… **YOLO é»˜è®¤æ”¯æŒ**: æ— éœ€é¢å¤–ä»£ç é€‚é…
6. âœ… **å…¼å®¹æ€§å¥½**: æ‰€æœ‰å·¥å…·éƒ½æ”¯æŒ

---

## ğŸ“ ä½ çš„ Depth Anything V2 è„šæœ¬åˆ†æ

### å½“å‰ä»£ç  (run.py ç¬¬ 56-63 è¡Œ)

```python
# å½’ä¸€åŒ–åˆ°0-255
depth = (depth - depth.min()) / (depth.max() - depth.min()) * 255.0
depth = depth.astype(np.uint8)  # âœ… uint8 = Læ¨¡å¼!

if args.grayscale:
    depth = np.repeat(depth[..., np.newaxis], 3, axis=-1)  # ç°åº¦è½¬RGB (ä¸æ¨è)
else:
    depth = (cmap(depth)[:, :, :3] * 255)[:, :, ::-1].astype(np.uint8)  # å½©è‰²æ·±åº¦å›¾

# ä¿å­˜
cv2.imwrite(os.path.join(args.outdir, ...), depth)
```

**åˆ†æ**:

- âœ… ä½ ä½¿ç”¨äº† `--pred-only --grayscale`
- âœ… è¾“å‡ºæ˜¯ uint8 æ ¼å¼ (0-255)
- âœ… cv2.imwrite ä¿å­˜çš„ç°åº¦å›¾ = PIL çš„ L æ¨¡å¼
- âœ… **ä½ çš„ VisDrone æ·±åº¦å›¾å·²ç»æ˜¯ L æ¨¡å¼ï¼**

---

## ğŸ”§ éœ€è¦åšçš„ä¿®æ”¹

### âŒ ä¸éœ€è¦ä¿®æ”¹ generate_depths_uavdt.py!

å½“å‰ä»£ç å·²ç»æ­£ç¡®ï¼š

```python
# ç¬¬58-70è¡Œ - ä¿æŒä¸å˜!
depth_normalized = (depth - depth_min) / (depth_max - depth_min) * 255
depth_uint8 = depth_normalized.astype(np.uint8)
depth_img = Image.fromarray(depth_uint8, mode='L')  # âœ… Læ¨¡å¼
depth_img.save(output_path)
```

### âœ… ç¡®è®¤ VisDrone æ·±åº¦å›¾æ ¼å¼

è¿è¡Œè¿™ä¸ªå¿«é€Ÿæ£€æŸ¥ï¼š

```python
from PIL import Image
import numpy as np

# æ£€æŸ¥VisDroneçš„ä¸€å¼ æ·±åº¦å›¾
vd_depth = Image.open('/data2/.../VisDrone/depths/train/xxx.png')
print(f"æ¨¡å¼: {vd_depth.mode}")  # æœŸæœ›: 'L'
print(f"ç±»å‹: {np.array(vd_depth).dtype}")  # æœŸæœ›: uint8
print(f"èŒƒå›´: {np.array(vd_depth).min()} - {np.array(vd_depth).max()}")  # æœŸæœ›: 0-255
```

**å¦‚æœè¾“å‡ºæ˜¯ mode='L', dtype=uint8, range=0-255**:

- âœ… å®Œç¾! ç›´æ¥å¼€å§‹ç”Ÿæˆ UAVDT æ·±åº¦å›¾
- âœ… generate_depths_uavdt.py æ— éœ€ä¿®æ”¹
- âœ… ä¸¤ä¸ªæ•°æ®é›†æ ¼å¼ä¸€è‡´

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯” (23,829 å¼  UAVDT å›¾åƒ)

| æŒ‡æ ‡     | L æ¨¡å¼ (8-bit) | I æ¨¡å¼ (32-bit) | å†³ç­–                |
| -------- | -------------- | --------------- | ------------------- |
| å­˜å‚¨å¤§å° | **~50 GB**     | ~200 GB         | âœ… L æ¨¡å¼èŠ‚çœ 150GB |
| è¯»å–é€Ÿåº¦ | **å¿« (1.0x)**  | æ…¢ (0.7x)       | âœ… L æ¨¡å¼å¿« 43%     |
| ç²¾åº¦     | **256 levels** | 42 äº¿ levels    | âœ… L æ¨¡å¼å¤Ÿç”¨       |
| è®­ç»ƒæ”¯æŒ | **åŸç”Ÿæ”¯æŒ**   | éœ€è¦é€‚é…        | âœ… L æ¨¡å¼å³æ’å³ç”¨   |
| ç‰¹å¾æå– | **è¶³å¤Ÿ**       | è¿‡å‰©            | âœ… L æ¨¡å¼æ€§ä»·æ¯”é«˜   |

---

## ğŸš€ æ‰§è¡Œè®¡åˆ’

### Step 1: éªŒè¯ VisDrone æ ¼å¼ (1 åˆ†é’Ÿ)

```bash
python -c "
from PIL import Image
import numpy as np
from pathlib import Path

vd_dir = Path('/data2/.../VisDrone/depths/train')
sample = list(vd_dir.glob('*.png'))[0]
img = Image.open(sample)
arr = np.array(img)

print(f'VisDroneæ·±åº¦å›¾:')
print(f'  æ¨¡å¼: {img.mode}')
print(f'  ç±»å‹: {arr.dtype}')
print(f'  èŒƒå›´: {arr.min()}-{arr.max()}')
print(f'  å¤§å°: {img.size}')

if img.mode == 'L' and arr.dtype == np.uint8:
    print('\\nâœ… ç¡®è®¤: VisDroneä½¿ç”¨Læ¨¡å¼')
    print('âœ… generate_depths_uavdt.py æ— éœ€ä¿®æ”¹')
    print('âœ… å¯ä»¥ç›´æ¥å¼€å§‹ç”ŸæˆUAVDTæ·±åº¦å›¾')
else:
    print('\\nâš ï¸ è­¦å‘Š: VisDroneæ ¼å¼ä¸æ˜¯æ ‡å‡†Læ¨¡å¼')
"
```

### Step 2: ç”Ÿæˆ UAVDT æ·±åº¦å›¾ (4-6 å°æ—¶)

```bash
cd /data2/.../yoloDepth
CUDA_VISIBLE_DEVICES=7 python generate_depths_uavdt.py
```

**é¢„æœŸè¾“å‡º**: 23,829 å¼  PNG æ–‡ä»¶ï¼Œmode=L, dtype=uint8, ~50GB

### Step 3: éªŒè¯ä¸€è‡´æ€§ (1 åˆ†é’Ÿ)

```python
from PIL import Image
import numpy as np

vd = Image.open('VisDrone/depths/train/xxx.png')
uavdt = Image.open('UAVDT_YOLO/train/depths/xxx.png')

print(f"VisDrone: {vd.mode}, {np.array(vd).dtype}, {np.array(vd).shape}")
print(f"UAVDT: {uavdt.mode}, {np.array(uavdt).dtype}, {np.array(uavdt).shape}")

if vd.mode == uavdt.mode == 'L':
    print("âœ… ä¸¤ä¸ªæ•°æ®é›†æ·±åº¦å›¾æ ¼å¼ä¸€è‡´!")
```

### Step 4: å¼€å§‹è”åˆè®­ç»ƒ (30-40 å°æ—¶)

```bash
CUDA_VISIBLE_DEVICES=7 python train_depth.py \
    --data visdrone_uavdt_joint.yaml \
    --epochs 300 \
    --batch 16 \
    --name exp_joint_v1 \
    --weights yolo12n.pt
```

---

## â“ å¦‚æœä½ ä¹‹å‰ç”¨äº† I æ¨¡å¼æ€ä¹ˆåŠï¼Ÿ

### åœºæ™¯ 1: VisDrone ç¡®å®æ˜¯ I æ¨¡å¼ (ä¸å¤ªå¯èƒ½)

**æ£€æŸ¥æ–¹å¼**:

```python
img = Image.open('VisDrone/depths/train/xxx.png')
if img.mode == 'I':
    print("ç¡®è®¤æ˜¯Iæ¨¡å¼")
```

**å¦‚æœæ˜¯ I æ¨¡å¼ï¼Œéœ€è¦ç»Ÿä¸€**:

#### é€‰é¡¹ A: å°† UAVDT æ”¹ä¸º I æ¨¡å¼ (ä¸æ¨èï¼Œæµªè´¹å­˜å‚¨)

ä¿®æ”¹ `generate_depths_uavdt.py` ç¬¬ 58-70 è¡Œï¼š

```python
depth_normalized = (depth - depth_min) / (depth_max - depth_min) * 65535
depth_int32 = depth_normalized.astype(np.int32)
depth_img = Image.fromarray(depth_int32, mode='I')
```

#### é€‰é¡¹ B: å°† VisDrone æ”¹ä¸º L æ¨¡å¼ (æ¨è!) â­

é‡æ–°ç”Ÿæˆ VisDrone æ·±åº¦å›¾ï¼Œä½¿ç”¨ L æ¨¡å¼ï¼š

```bash
CUDA_VISIBLE_DEVICES=4 python run.py \
    --encoder vits \
    --img-path /data2/.../VisDrone/images/train \
    --outdir /data2/.../VisDrone/depths/train_L \
    --pred-only --grayscale
```

ç„¶åç”¨æ–°çš„ L æ¨¡å¼æ·±åº¦å›¾æ›¿æ¢æ—§çš„ã€‚

---

## ğŸ“ å…«è‚¡çŸ¥è¯†ç‚¹ - ä¸ºä»€ä¹ˆ L æ¨¡å¼å¤Ÿç”¨ï¼Ÿ

### æ·±åº¦å›¾åœ¨ç›®æ ‡æ£€æµ‹ä¸­çš„ä½œç”¨

æ·±åº¦å›¾ä¸æ˜¯ç”¨æ¥**ç²¾ç¡®é‡å»º 3D**ï¼Œè€Œæ˜¯ç”¨æ¥**æä¾›ç©ºé—´å‡ ä½•å…ˆéªŒ**ï¼š

1. **ç›¸å¯¹æ·±åº¦å…³ç³»** (è¿œè¿‘é¡ºåº)

   - 256 ä¸ªçº§åˆ«è¶³ä»¥è¡¨ç¤º"è¿‘ã€ä¸­ã€è¿œ"çš„åŒºåˆ†
   - ä¾‹: 0-85 (è¿‘), 86-170 (ä¸­), 171-255 (è¿œ)

2. **è¾¹ç¼˜å’Œè½®å»“ä¿¡æ¯**

   - æ·±åº¦çªå˜ â†’ ç‰©ä½“è¾¹ç•Œ
   - L æ¨¡å¼çš„ 256 çº§åˆ«è¶³ä»¥æ•è·è¾¹ç¼˜

3. **ç‰¹å¾èåˆè¾“å…¥**
   - æ·±åº¦å›¾ç»è¿‡å·ç§¯åå˜æˆç‰¹å¾å›¾
   - å·ç§¯æ“ä½œè¿›ä¸€æ­¥å¹³æ»‘ï¼Œ256 çº§åˆ«ç²¾åº¦ä¿ç•™

### ä»€ä¹ˆæ—¶å€™éœ€è¦ I æ¨¡å¼ï¼Ÿ

- âŒ ä¸éœ€è¦: ç›®æ ‡æ£€æµ‹ã€åˆ†ç±»ã€åˆ†å‰² (ç‰¹å¾æå–ä»»åŠ¡)
- âœ… éœ€è¦: 3D é‡å»ºã€SLAMã€ç‚¹äº‘ç”Ÿæˆ (éœ€è¦ç‰©ç†æ·±åº¦å€¼)

### ç±»æ¯”: å›¾åƒ RGB å€¼

- RGB å›¾åƒæ¯ä¸ªé€šé“ä¹Ÿæ˜¯ 0-255 (8-bit)
- ä¸ºä»€ä¹ˆä¸ç”¨ 32-bit RGB? å› ä¸º**æ²¡å¿…è¦**!
- åŒç†ï¼Œæ·±åº¦å›¾çš„ 256 çº§åˆ«å®Œå…¨å¤Ÿç”¨

---

## âœ… æœ€ç»ˆå†³ç­–æ€»ç»“

### å†³ç­–: **å…¨éƒ¨ä½¿ç”¨ L æ¨¡å¼** â­

**åŸå› **:

1. âœ… ä½ çš„ Depth Anything V2 å·²ç»è¾“å‡º uint8 (L æ¨¡å¼)
2. âœ… ç²¾åº¦è¶³å¤Ÿ (256 levels)
3. âœ… èŠ‚çœ 150GB å­˜å‚¨
4. âœ… è®­ç»ƒæ›´å¿«
5. âœ… æ— éœ€ä»£ç ä¿®æ”¹

**è¡ŒåŠ¨**:

1. âœ… éªŒè¯ VisDrone æ˜¯ L æ¨¡å¼ (é¢„æœŸæ˜¯)
2. âœ… ä¿æŒ generate_depths_uavdt.py ä¸å˜
3. âœ… ç›´æ¥è¿è¡Œç”Ÿæˆ UAVDT æ·±åº¦å›¾
4. âœ… å¼€å§‹è”åˆè®­ç»ƒ

**å¦‚æœ VisDrone ä¸æ˜¯ L æ¨¡å¼**:

- âš ï¸ é‡æ–°ç”Ÿæˆ VisDrone æ·±åº¦å›¾ (æ¨è)
- âš ï¸ æˆ–ä¿®æ”¹ UAVDT è„šæœ¬åŒ¹é… VisDrone (ä¸æ¨è)

---

**æ€»ç»“**: é™¤éæœ‰ç‰¹æ®Šéœ€æ±‚ (3D é‡å»º/SLAM)ï¼Œå¦åˆ™**L æ¨¡å¼æ˜¯æœ€ä½³é€‰æ‹©**ï¼ä½ çš„ Depth Anything V2 è„šæœ¬å·²ç»åœ¨ç”¨ L æ¨¡å¼äº†ï¼Œä¿æŒä¸å˜å³å¯ï¼ğŸš€
